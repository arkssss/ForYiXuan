<include file = "Base/head" />
<meta charset="utf-8" />
<style type="text/css">
    .head_face{
        width: 100px;
        height: 100px;
    }  
    .head_face_frame{
        width: 50%;
        margin: 0 auto;
        margin-top: 50px;
        margin-bottom: 100px;
    }
    .plus_minus_button{
        width:50%; 
        margin:0 auto;
    }
    @media screen and (max-width: 600px){
        .head_face_frame{
            width: 100%;
            margin: 0 auto;
            margin-top: 50px;
            margin-bottom: 100px;
            
        }
        .plus_minus_button{
            width:70%; 
            margin:0 auto;
        }

    }

    .item{
        margin: 100px auto;
    }
    .heart_frame{
        width: 80%;
        height: 150px;
    }
    #heart{
        margin: 50px auto; 
        width: 100px;
        height: 90px; 
        /* position:  absolute;
        top: 50%;
        left: 50%; */
        -webkit-animation: pound 1s infinite;
        -ms-animation: pound 1s infinite;
        -moz-animation: pound 1s infinite;
        -o-animation: pound 1s infinite;
        animation: pound 1s infinite;
    }
    #heart:before,#heart:after{
        position: absolute; 
        content: ""; 
        left: 50px; 
        top: 20%; 
        width: 50px; 
        height: 80px;
        background: #ff749f;
        border-radius: 50px 50px 0 0;
        -webkit-border-radius: 50px 50px 0 0;
        -ms-border-radius: 50px 50px 0 0;
        -moz-border-radius: 50px 50px 0 0;
        -o-border-radius: 50px 50px 0 0;
        transform: rotate(-45deg);
        -webkit-transform: rotate(-45deg);
        -ms-transform: rotate(-45deg);
        -moz-transform: rotate(-45deg);
        -o-transform: rotate(-45deg);
        transform-origin: 0 100%;
        -webkit-transform-origin: 0 100%;
        -ms-transform-origin: 0 100%;
        -moz-transform-origin: 0 100%;
        -o-transform-origin: 0 100%;
    }
    #heart:after{
        left: 0px; 
        transform: rotate(45deg);
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        -moz-transform: rotate(45deg);
        -o-transform: rotate(45deg);
        transform-origin: 100% 100%;
        -webkit-transform-origin: 100% 100%;
        -ms-transform-origin: 100% 100%;
        -moz-transform-origin: 100% 100%;
        -o-transform-origin: 100% 100%;
    }
    @keyframes pound {
        from { transform: scale(1.0);}
        30% { transform: scale(1.2);}
        40% { transform: scale(1.6);}
        50% { transform: scale(1.2);}
        60% { transform: scale(1.6);}
        70% { transform: scale(1.2);}
        to { transform: scale(1.0);}
    }


    </style>
</head>
<body>
<!-- åŒ…å«ä¾§æ çš„å¯¼èˆªæ¡ -->
<include file="Base/NavBar_v2" />

<div class="container" style="margin:100px auto;">

    <h2 class="text-center">
            å¥½æ„Ÿç²¾çµ ğŸ§šâ€
    </h2>

    <div class="row head_face_frame">

            <div class="col-lg-4 col-xs-5">
                <img src="__UserFace__/{$my_info.face_img}"  class="head_face img-circle center-block">
                <h4 class="text-center">æˆ‘</h4>
            </div>
    
            <div class="col-lg-4 col-xs-2   ">
    
                <h1 class="text-center">
    
                    <i class="glyphicon glyphicon-arrow-right"> </i>
                </h1>
    
            </div>
    
    
            <div class="col-lg-4 col-xs-5 pull-right">
                <img src="__UserFace__/{$lover_info.face_img}" class="head_face img-circle center-block">
                <h4 class="text-center">{$lover_info.nickname}</h4>
            </div>
    
    </div>




    <!-- Heart -->
    <div class="item heart_frame">
        <div id="heart" class="center-block"></div>
    </div> 



    <h2 class="text-center" style="color : #ff749f; margin-top: 200px">
            å¥½æ„Ÿå€¼
    </h2>
    
    <h2 class="loving_value text-center" style="color : #ff749f">

    </h2>


    <div class="row" style="margin-top:100px">

        <h4 class="text-center text-info">æˆ‘è¦ä¿®æ”¹å¥½æ„Ÿå•¦</h4>
        <hr>

        <div class="btn-group btn-group-sm" style="margin: 50px auto;display: table;">
                <h5 class="text-center">é€‰æ‹©å¢åŠ (å‡å°‘)å°ºåº¦</h5>
                <button type="button" class="btn btn-default scale" value="0.1">0.1</button>
                <button type="button" class="btn btn-default scale" value="0.2">0.2</button>
                <button type="button" class="btn btn-default scale" value="0.3">0.3</button>
                <button type="button" class="btn btn-default scale" value="0.4">0.4</button>
                <button type="button" class="btn btn-default scale" value="0.5">0.5</button>
        </div>
        <div class="plus_minus_button" class="col-lg-12">
            <button id="minus" class="btn btn-danger col-lg-2 col-sx-4"> <i class="glyphicon glyphicon-thumbs-down"></i>&nbsp;<i class="glyphicon glyphicon-minus"></i> <i id="current_scale" class="scale_number">0.1</i> </button>
            <button id="plus"  class="btn btn-info col-lg-2 col-sx-4 pull-right"> <i class="glyphicon glyphicon-thumbs-up"></i>&nbsp;<i class="glyphicon glyphicon-plus"></i> <i class="scale_number">0.1</i></button>
        </div>      

        <div class="col-lg-12" style="margin-top: 100px">
            <button id="confirm" class="center-block btn btn-info btn-lg">ç¡®è®¤ä¿®æ”¹</button>
        </div>

    </div>

</div>
 
<include file = "Base/foot" />
</body>
<script>

    var MAX_LOVING = 100.0
    var MIN_LOVING = 10.0

    
    // from data_base init å¥½æ„Ÿå€¼
    var init_loving= parseFloat("{$loving_info.value}");

    
    // å½“å‰çš„å¥½æ„Ÿå€¼
    var current_loving = init_loving;

    // 50 å¯¹äºå¤§å°ä¸º 1 çš„å¿ƒ
    var rate = 0.025

    // æ¯ä¸ªå¸§æ•°çš„ç¼©æ”¾æ¯”ä¾‹
    var scale_rate = new Array(1.2, 1.4, 1.8, 1.4, 1.8, 1.4, 1.2);


    //åˆå§‹åŒ–
    $(document).ready(function(){
        // insert lovint value
        change_display_value(init_loving);

        var frames = get_frames_array(current_loving);

        // insert 
        $("#heart").append(get_stype(frames));
        
    })  


    // è·å¾—å½“å‰çš„å¿ƒçš„size æ•°ç»„
    function get_frames_array(current_value) {

        current_size = rate * current_value;

        var frames  = new Array();

        for(var i = 0 ;i<scale_rate.length;i++){
            frames[i] = scale_rate[i] * current_size;
        }  
        
        return frames;

    }



    // æ”¹å˜æ˜¾ç¤ºçš„å€¼
    function change_display_value(my_value){

         $(".loving_value").html(my_value);

    }



    // ä½†ä¼šæ’å…¥çš„æ”¹å˜æ ·å¼çš„string
    function get_stype(frames){

        return  " <style>@keyframes pound {" +
                        "from { transform: scale("+frames[0]+");}" + 
                        "30% { transform: scale("+frames[1]+");}" +
                        "40% { transform: scale("+frames[2]+");}" +
                        "50% { transform: scale("+frames[3]+");}" +
                        "60% { transform: scale("+frames[4]+");}" + 
                        "70% { transform: scale("+frames[5]+");}" +
                        "to { transform: scale("+frames[6]+");}" +
            "</style>" ;
    }






    // click æ”¹å˜æ ·å¼
    $('#plus').click(function(){

        var current_scale = parseFloat($("#current_scale").text());
        
        if(!check_scale(current_loving+current_scale)) return;        
        // fix ç²¾åº¦é—®é¢˜
        current_loving += current_scale;
        // console.log(typeof(current_loving));
        current_loving = parseFloat(current_loving.toFixed(1))

        
        change_display_value(current_loving);


        var frames = get_frames_array(current_loving);

        // insert 
        $("#heart").append(get_stype(frames));


    })


    // click æ”¹å˜æ ·å¼
    $('#minus').click(function(){ 

        var current_scale = parseFloat($("#current_scale").text());
        
        if(!check_scale(current_loving-current_scale)) return;

        // fix ç²¾åº¦é—®é¢˜
        current_loving -= current_scale;
        current_loving = parseFloat(current_loving.toFixed(1))

        
        change_display_value(current_loving);


        var frames = get_frames_array(current_loving);

        // insert 
        $("#heart").append(get_stype(frames));


    })

    // å¥½æ„Ÿä¸å¯ä»¥ä¸€ç›´å¢é•¿
    function check_scale(value){

        if(value > MAX_LOVING) {
            layer.alert("å¥½æ„Ÿæœ€å¤šåªèƒ½æ˜¯100å“¦, å½“ç„¶å°ä»»ä»»è¿˜æƒ³å¢åŠ , å»è”ç³»å°èˆŸå§", {skin: 'layui-layer-lan', title :'å°èˆŸè¯´:'}) ;
            return false;
            }
        if(value < MIN_LOVING){
            layer.alert("å°ä»»ä»»ä½ æƒ³å¹²å˜›!! è¿˜è¦å‡å°èˆŸçš„å¥½æ„Ÿ, æˆ‘è¦giaoä½ äº†!!", {skin: 'layui-layer-lan', title :'å°èˆŸè¯´:'});
            return false;
        }
        return true;

    }


    // å°ºåº¦æŒ‰é’®
    $(".scale").click(function(){
        var change_scale = $(this).attr('value');
        $(".scale_number").text(change_scale);
    })


    // æäº¤ä¿®æ”¹
    $("#confirm").click(function(){ 

        var comment = ""
        var url = "{:U('LovingValue/update')}"
        if(current_loving == init_loving) {
            layer.alert("å°ä»»ä»»ä½ æ²¡æœ‰æ”¹å•¦, ä¼‘æƒ³éª—æˆ‘!!", {skin: 'layui-layer-lan', title :'å°èˆŸè¯´:'});
            return;
        }
        // å¥½æ„Ÿå¢åŠ 
        if(current_loving > init_loving){

            layer.prompt({
            formType: 2,
            title: 'å¥½æ„Ÿä¸Šå‡äº†è¯¶, å°ä»»ä»»è®°å½•ä¸‹å¿ƒåŠ¨ç†ç”±å§',
            }, function(value, index, elem){
            layer.close(index);
            var loding  = layer.load(1, {
                shade: [0.1,'#fff'] //0.1é€æ˜åº¦çš„ç™½è‰²èƒŒæ™¯
            });
            // è·å–æ–‡æœ¬    
            comment = value;    

            $.post(
                url,
                {
                    'comment' : comment,
                    'up_down' : 1 , // 1 è¡¨ç¤ºä¸Šå‡
                    'current_loving'   : current_loving,
                    'to'      : "{$lover_info.id}"
                },
                function(obj){
                    obj = JSON.parse(obj);
                    // è¿”å›æ¶ˆæ¯
                    layer.close(loding) 
                    layer.alert(obj.msg, {skin: 'layui-layer-lan',      title :'å°èˆŸè¯´:'})
                }
            )        

            });
            

        }
        // å¥½æ„Ÿå‡å°‘
        if(current_loving < init_loving){

             layer.prompt({
            formType: 2,
            title: 'å¥½æ„Ÿä¸‹é™äº†è¯¶, å†™ä¸‹å°èˆŸåšäº†ä»€ä¹ˆè¿‡åˆ†çš„äº‹å§!',
            }, function(value, index, elem){
            layer.close(index);
            // è·å–æ–‡æœ¬    
            comment = value;  
            var loding  = layer.load(1, {
                shade: [0.1,'#fff'] //0.1é€æ˜åº¦çš„ç™½è‰²èƒŒæ™¯
            });
            $.post(
                url,
                {
                    'comment' : comment,
                    'up_down' : 0 , // 1 è¡¨ç¤ºä¸Šå‡
                    'current_loving'   : current_loving,
                    'to'      : "{$lover_info.id}"
                },
                function(obj){
                    obj = JSON.parse(obj);
                    // è¿”å›æ¶ˆæ¯
                    layer.close(loding);
                    layer.alert(obj.msg, {skin: 'layui-layer-lan',      title :'å°èˆŸè¯´:'})
                }
            )        

            });


        }

    })



</script>


</html> 